---
import { markdownify } from "@/lib/utils/textConverter";
import type { Button } from "@/types";

interface Props {
  title: string;
  content: string;
  image: string;
  bulletpoints?: string[];
  button?: Button;
  index: number;
  id?: string;
}

const { title, content, image, bulletpoints = [], button, index, id } = Astro.props;

// Pre-process markdown content
const featureTitle = await markdownify(title);
const featureContent = await markdownify(content);

// Process bullet points
const processedBulletPoints = await Promise.all(
  bulletpoints.map(async (bullet: string) => await markdownify(bullet))
);

// Determine if image should be on the right (odd index)
const imageRight = index % 2 !== 0;
---

<section 
  class="section-sm bg-black text-white"
  id={id}
>
  <div class="container">
    <div class="row items-center justify-between">
      <div
        class={`mb:md-0 mb-6 md:col-5 ${imageRight && "md:order-2"}`}
      >
        <img
          src={image}
          height={480}
          width={520}
          alt={title}
          class="feature-image"
        />
      </div>
      <div class={`md:col-7 lg:col-6 ${imageRight && "md:order-1"}`}>
        <h2 set:html={featureTitle} class="mb-4 text-white uppercase" style="font-size: 2rem;" />
        <p set:html={featureContent} class="mb-8 text-lg text-white" />
        {processedBulletPoints.length > 0 && (
          <ul>
            {processedBulletPoints.map((bullet: string) => (
              <li class="flex items-center mb-4 text-white text-lg">
                <span class="mr-3 flex-shrink-0 text-white">&#10022;</span>
                <span set:html={bullet} class="text-lg" />
              </li>
            ))}
          </ul>
        )}
        {button?.enable && (
          <a 
            class="btn-retro mt-5 inline-block" 
            href={button.link}
            target={button.link.startsWith("http") ? "_blank" : "_self"}
            rel={button.link.startsWith("http") ? "noopener noreferrer" : ""}
          >
            {button.label}
          </a>
        )}
      </div>
    </div>
  </div>
</section>

<style>
  .feature-image {
    image-rendering: auto !important;
    image-rendering: smooth !important;
    image-rendering: high-quality !important;
    image-rendering: -webkit-optimize-contrast !important;
    max-width: 100%;
    height: auto;
  }
</style> 