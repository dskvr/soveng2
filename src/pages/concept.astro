---
import Base from "@/layouts/Base.astro";
import slideLoop from "@/data/common-slides/show-talk-build-loop.jpeg";
import weeklyRhythmData from "@/data/weeklyRhythm.json";
import { markdownify } from "@/lib/utils/textConverter";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";

// Get concept content
const concept = (await getEntry(
  "concept",
  "-index"
)) as CollectionEntry<"concept">;

const { title, meta_title, description, intro, sections, cta } = concept.data;

// Process markdown content
const introContent = await markdownify(intro.content);
const processedSections = await Promise.all(
  sections.map(async (section: any) => ({
    ...section,
    content: await markdownify(section.content),
  }))
);
---

<Base
  title={title}
  meta_title={meta_title}
  description={description}
>
  <section class="section-sm">
    <div class="container">
      <div class="row justify-center">
        <div class="text-center md:col-10 lg:col-7">
          <h2 class="h3 mb-6">{title}</h2>
          <div class="content text-left">
            <figure class="my-8">
              <img src={slideLoop.src} alt="Show • Talk • Build cycle" class="rounded-lg shadow-lg mx-auto" loading="lazy" />
            </figure>
            <div set:html={introContent}></div>

            {processedSections.map((section) => (
              <>
                <h3 class="h4 mt-8 mb-4">{section.title}</h3>
                <div class="content text-left" set:html={section.content}></div>
                {section.id === "weekly-loop" && (
                  <>
                    <p class="mt-6">The cadence unfolds like this:</p>
                    <ul class="list-disc pl-6 space-y-1">
                      {weeklyRhythmData.schedule.map((item) => (
                        <li><strong>{item.day}</strong>&nbsp;– {item.description}</li>
                      ))}
                    </ul>
                    <p class="mt-6">Walks, workshops, and time-boxed demos are not décor—they are load-bearing rituals. They mix the group, surface blind spots early, and keep exit-costs for bad ideas near zero. When the bell rings on Friday everyone ships, learns, and immediately sets course for the next horizon.</p>
                  </>
                )}
                {section.image && (
                  <img 
                    src={`/images/${section.image}`} 
                    alt={section.title} 
                    loading="lazy" 
                    class={`w-1/2 md:w-1/3 lg:w-1/4 ${section.float === "left" ? "float-left mr-4" : "float-right ml-4"} mb-4 rounded-lg shadow-lg`} 
                  />
                )}
              </>
            ))}
          </div>
          <div class="text-center mt-10">
            <a href={cta.link} class="btn-retro">{cta.text}</a>
          </div>
        </div>
      </div>
    </div>
  </section>
</Base> 